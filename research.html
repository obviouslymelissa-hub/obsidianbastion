<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Research Lab — Obsidian Bastion</title>
  <link rel="stylesheet" href="app.css">
  <style>
    /* Page-specific layout and styling */
    .wrap { max-width:1200px; margin:24px auto; padding:0 18px; }
    .page-header { margin-bottom:24px; }
    .page-header h1 { margin:0 0 8px 0; font-size:1.8rem; color:var(--text-main); }
    .hint { color:var(--muted); font-size:0.95rem; line-height:1.5; }
    
    /* Grid layout: form on left, list on right */
    .grid { display:grid; grid-template-columns: 380px 1fr; gap:20px; margin-top:20px; }
    @media (max-width: 980px) {
      .grid { grid-template-columns: 1fr; }
    }
    
    /* Panel card styling */
    .panel-card { 
      background:var(--bg-panel, #151821); 
      padding:20px; 
      border-radius:12px; 
      border:1px solid rgba(255,255,255,0.06);
      box-shadow: 0 6px 20px rgba(0,0,0,0.35);
    }
    .panel-card h3 { 
      margin:0 0 16px 0; 
      font-size:1.2rem; 
      color:var(--accent); 
      font-weight:700; 
    }
    
    /* Form styling */
    .form-group { margin-bottom:16px; }
    .form-group label { 
      display:block; 
      margin-bottom:6px; 
      font-weight:600; 
      color:var(--text-main); 
      font-size:0.95rem; 
    }
    .form-group input,
    .form-group textarea,
    .form-group select {
      width:100%;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.08);
      background:rgba(255,255,255,0.02);
      color:var(--text-main);
      font-family:inherit;
      font-size:0.95rem;
    }
    .form-group textarea {
      min-height:100px;
      resize:vertical;
    }
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline:2px solid rgba(79,209,197,0.3);
      outline-offset:0;
      border-color:var(--accent);
    }
    
    /* Button styling */
    .btn {
      background:var(--accent);
      color:var(--bg-panel);
      padding:10px 16px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      font-weight:700;
      font-size:0.95rem;
      transition:transform 0.12s ease, box-shadow 0.12s ease;
      box-shadow:0 4px 12px rgba(0,0,0,0.3);
    }
    .btn:hover {
      transform:translateY(-2px);
      box-shadow:0 6px 18px rgba(0,0,0,0.4);
    }
    .btn.secondary {
      background:rgba(255,255,255,0.06);
      color:var(--text-main);
    }
    .btn.danger {
      background:#e53e3e;
      color:#fff;
    }
    .btn.small {
      padding:6px 12px;
      font-size:0.85rem;
    }
    
    /* Research item card styling */
    .research-list {
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .research-item {
      background:rgba(255,255,255,0.02);
      padding:16px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.04);
      transition:background 0.2s ease;
    }
    .research-item:hover {
      background:rgba(255,255,255,0.04);
    }
    .research-header {
      display:flex;
      justify-content:space-between;
      align-items:start;
      margin-bottom:10px;
    }
    .research-title {
      font-size:1.1rem;
      font-weight:700;
      color:var(--text-main);
      margin:0 0 6px 0;
    }
    .research-status {
      padding:4px 10px;
      border-radius:6px;
      font-size:0.8rem;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:0.5px;
    }
    .status-not-started { background:rgba(255,255,255,0.06); color:var(--muted); }
    .status-in-progress { background:rgba(251,191,36,0.15); color:#fbbf24; }
    .status-complete { background:rgba(79,209,197,0.15); color:var(--accent); }
    
    .research-description {
      color:var(--text-muted);
      font-size:0.9rem;
      line-height:1.5;
      margin-bottom:12px;
    }
    .research-actions {
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    
    /* Empty state */
    .empty-state {
      text-align:center;
      padding:60px 20px;
      color:var(--muted);
    }
    .empty-state svg {
      width:64px;
      height:64px;
      margin-bottom:16px;
      opacity:0.3;
    }
    .empty-state p {
      font-size:1.1rem;
      margin:0;
    }
  </style>
</head>
<body>
  <!-- Shared header -->
  <header class="site-header">
    <div class="wrap header-wrap" style="display:flex;justify-content:space-between;align-items:center;">
      <div class="header-left">
        <img src="images/StrOpBoard.png" alt="Strategic Operations Board" style="height:44px">
        <div class="header-text" aria-label="Site title">
          <h1 style="margin:0">Obsidian Bastion</h1>
          <h2 style="margin:0;font-weight:400;font-size:13px;color:var(--muted)">Research Lab</h2>
        </div>
      </div>
      <div class="header-right">
        <a href="onboardcomputer.html" class="return-command-hub" aria-label="Return to Onboard Computer">← Return</a>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div class="page-header">
      <h1>Research & Development Lab</h1>
      <div class="hint">
        Document and track items collected by drones. Add custom research projects, track progress, and store important notes about discovered artifacts and resources.
      </div>
    </div>

    <div class="grid" role="main">
      <!-- Left: Add/Edit Form -->
      <aside class="panel-card" aria-label="Research form">
        <h3 id="formTitle">Add New Research Item</h3>
        <form id="researchForm">
          <input type="hidden" id="editingId" value="">
          
          <div class="form-group">
            <label for="itemName">Item Name *</label>
            <input 
              type="text" 
              id="itemName" 
              placeholder="e.g., Ancient Artifact, Crystal Sample" 
              required
              maxlength="100"
            >
          </div>

          <div class="form-group">
            <label for="itemDescription">Description</label>
            <textarea 
              id="itemDescription" 
              placeholder="Notes about this item, where it was found, what it might be used for..."
              maxlength="500"
            ></textarea>
          </div>

          <div class="form-group">
            <label for="itemStatus">Research Status</label>
            <select id="itemStatus">
              <option value="not-started">Not Started</option>
              <option value="in-progress">In Progress</option>
              <option value="complete">Complete</option>
            </select>
          </div>

          <div style="display:flex;gap:10px;">
            <button type="submit" class="btn" id="submitBtn">Add Item</button>
            <button type="button" class="btn secondary" id="cancelBtn" style="display:none;">Cancel</button>
          </div>
        </form>
      </aside>

      <!-- Right: Research Items List -->
      <section class="panel-card" aria-label="Research items">
        <h3>Research Items <span id="itemCount" style="color:var(--muted);font-weight:400;font-size:0.9rem;">(0)</span></h3>
        
        <div id="researchList" class="research-list">
          <!-- Items will be rendered here -->
        </div>

        <div id="emptyState" class="empty-state" style="display:none;">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <p>No research items yet</p>
          <p style="font-size:0.85rem;margin-top:8px;">Add your first research item using the form on the left</p>
        </div>
      </section>
    </div>
  </div>

  <footer style="text-align:center;color:var(--muted);padding:24px 0 40px;border-top:1px solid rgba(255,255,255,0.03);margin-top:32px;font-style:italic;">
    <div style="margin-bottom:12px">
      <a href="index.html" style="color:var(--accent);text-decoration:none;font-weight:600">Vessel Profile</a>
    </div>
    &copy; 2026 - Turning Imagination Into Galactic Frontiers.
  </footer>

  <script>
  (function(){
    // Storage key
    const STORAGE_KEY = 'research:items:v1';
    
    // Elements
    const form = document.getElementById('researchForm');
    const formTitle = document.getElementById('formTitle');
    const itemName = document.getElementById('itemName');
    const itemDescription = document.getElementById('itemDescription');
    const itemStatus = document.getElementById('itemStatus');
    const editingId = document.getElementById('editingId');
    const submitBtn = document.getElementById('submitBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const researchList = document.getElementById('researchList');
    const emptyState = document.getElementById('emptyState');
    const itemCount = document.getElementById('itemCount');

    // State
    let items = loadItems();

    // Load items from localStorage
    function loadItems() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch (e) {
        console.error('Failed to load items:', e);
        return [];
      }
    }

    // Save items to localStorage
    function saveItems() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
      } catch (e) {
        console.error('Failed to save items:', e);
      }
    }

    // Generate unique ID
    function generateId() {
      return 'r-' + Date.now() + '-' + Math.random().toString(36).slice(2, 9);
    }

    // Render all items
    function render() {
      researchList.innerHTML = '';
      
      if (items.length === 0) {
        researchList.style.display = 'none';
        emptyState.style.display = 'block';
        itemCount.textContent = '(0)';
        return;
      }
      
      researchList.style.display = 'flex';
      emptyState.style.display = 'none';
      itemCount.textContent = `(${items.length})`;
      
      // Sort: in-progress first, then not-started, then complete
      const sorted = [...items].sort((a, b) => {
        const order = { 'in-progress': 0, 'not-started': 1, 'complete': 2 };
        return order[a.status] - order[b.status];
      });
      
      sorted.forEach(item => {
        const card = document.createElement('div');
        card.className = 'research-item';
        
        const statusClass = `status-${item.status}`;
        const statusLabel = item.status.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
        
        card.innerHTML = `
          <div class="research-header">
            <div>
              <h4 class="research-title">${escapeHtml(item.name)}</h4>
              <div class="research-status ${statusClass}">${statusLabel}</div>
            </div>
          </div>
          ${item.description ? `<div class="research-description">${escapeHtml(item.description)}</div>` : ''}
          <div class="research-actions">
            <button class="btn small secondary" onclick="editItem('${item.id}')">Edit</button>
            <button class="btn small danger" onclick="deleteItem('${item.id}')">Delete</button>
          </div>
        `;
        
        researchList.appendChild(card);
      });
    }

    // Add or update item
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const id = editingId.value;
      const name = itemName.value.trim();
      const description = itemDescription.value.trim();
      const status = itemStatus.value;
      
      if (!name) {
        itemName.focus();
        return;
      }
      
      if (id) {
        // Update existing item
        const item = items.find(i => i.id === id);
        if (item) {
          item.name = name;
          item.description = description;
          item.status = status;
          item.updatedAt = Date.now();
        }
      } else {
        // Add new item
        const newItem = {
          id: generateId(),
          name,
          description,
          status,
          createdAt: Date.now(),
          updatedAt: Date.now()
        };
        items.push(newItem);
      }
      
      saveItems();
      render();
      resetForm();
    });

    // Edit item
    window.editItem = function(id) {
      const item = items.find(i => i.id === id);
      if (!item) return;
      
      editingId.value = item.id;
      itemName.value = item.name;
      itemDescription.value = item.description || '';
      itemStatus.value = item.status;
      
      formTitle.textContent = 'Edit Research Item';
      submitBtn.textContent = 'Update Item';
      cancelBtn.style.display = 'inline-block';
      
      // Scroll to form
      form.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      itemName.focus();
    };

    // Delete item
    window.deleteItem = function(id) {
      const item = items.find(i => i.id === id);
      if (!item) return;
      
      if (confirm(`Delete "${item.name}"? This cannot be undone.`)) {
        items = items.filter(i => i.id !== id);
        saveItems();
        render();
        
        // If we were editing this item, reset the form
        if (editingId.value === id) {
          resetForm();
        }
      }
    };

    // Cancel editing
    cancelBtn.addEventListener('click', resetForm);

    // Reset form to add mode
    function resetForm() {
      form.reset();
      editingId.value = '';
      formTitle.textContent = 'Add New Research Item';
      submitBtn.textContent = 'Add Item';
      cancelBtn.style.display = 'none';
    }

    // Escape HTML to prevent XSS
    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    // Initial render
    render();

    // Expose API for console debugging
    window.researchLab = {
      items: () => items,
      add: (name, desc, status) => {
        items.push({
          id: generateId(),
          name,
          description: desc || '',
          status: status || 'not-started',
          createdAt: Date.now(),
          updatedAt: Date.now()
        });
        saveItems();
        render();
      },
      clear: () => {
        if (confirm('Clear all research items?')) {
          items = [];
          saveItems();
          render();
        }
      }
    };
  })();
  </script>
</body>
</html>
