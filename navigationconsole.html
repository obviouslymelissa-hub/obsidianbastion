<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Navigation Console</title>
  <style>
    :root{ --bg:#071025; --card:#0f1724; --muted:#9aa6c0; --accent:#6ee7b7; color:#e6eef8; font-family:Inter,system-ui,Arial; }
    body{margin:0;background:linear-gradient(180deg,#020617,#071025);color:var(--muted)}
    .wrap{max-width:1100px;margin:24px auto;padding:18px}
    .header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
    h1{margin:0;color:#e6eef8;font-size:18px}
    .grid{display:grid;grid-template-columns:300px 1fr 420px;gap:14px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
    input,select,button{font:inherit}
    .list{display:flex;flex-direction:column;gap:8px}
    .small{font-size:13px;color:var(--muted)}
    .controls{display:flex;gap:8px;align-items:center;margin-bottom:8px}
    .preview{height:200px;border:0;width:100%;border-radius:8px;background:#041427;padding:12px;box-sizing:border-box;color:#bfe6ff}
    .btn{background:var(--accent);color:#042023;padding:8px 10px;border-radius:8px;border:0;cursor:pointer}
    .muted{color:var(--muted);font-size:13px}
    pre.json{white-space:pre-wrap;background:#041427;padding:8px;border-radius:6px;color:#bfe6ff;max-height:280px;overflow:auto}
    .row{display:flex;gap:8px;align-items:center}
    .icon-btn{background:transparent;border:0;color:var(--muted);cursor:pointer;padding:6px;border-radius:6px}
    .icon-btn:hover{color:#e6eef8;background:rgba(255,255,255,0.02)}
    .favorite{color:#ffd66b}
    .preset-btn{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:6px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.02)}
    .preset-left{display:flex;gap:8px;align-items:center}
    .seed-tag{font-weight:700;color:#e6eef8}
    .status{padding:8px;border-radius:8px;background:#2b1220;color:#ffd6e0;margin-bottom:12px}
    .mini-stat{display:flex;align-items:center;gap:8px;margin-top:8px}
    .temp-bar{height:12px;border-radius:6px;background:linear-gradient(90deg,#0ff,#f90);width:100%}
    @media print { body{background:white;color:#000} .no-print{display:none} }
  </style>
</head>
<body>
  <div class="wrap">
    <div id="statusContainer"></div>
    <div class="header">
      <h1>Navigation Console</h1>
      <div class="small">Pick a destination (or enter a custom name) and preview atmospheric conditions. The generator is embedded so this page works on static hosting and file://.</div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="small row" style="justify-content:space-between;align-items:center">
          <div>Favorites</div>
          <div class="small muted" id="favCount">0</div>
        </div>

        <div id="favList" class="list" style="margin-top:8px"></div>

        <hr style="margin:10px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">

        <div class="label small">Destinations</div>
        <div class="list" id="destList" style="margin-top:8px"></div>

        <hr style="margin:10px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">
        <div class="small">Or enter a custom seed/name</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="customName" placeholder="e.g. Kepler-452a" style="flex:1;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:#e6eef8">
          <button id="goBtn" class="btn" title="Select custom seed">Go</button>
        </div>
        <div style="margin-top:10px" class="muted">Use the star icon to favorite a seed. Favorites persist in the browser.</div>
      </div>

      <div class="card" id="displayCard">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="small">Selected</div>
            <div id="selectedName" style="font-weight:700;color:#e6eef8">—</div>
            <div id="selectedSummary" class="small" style="margin-top:6px">—</div>
          </div>
          <div style="display:flex;gap:6px;align-items:center">
            <button id="favToggle" class="icon-btn" title="Favorite / Unfavorite">
              <!-- star icon -->
              <svg id="favIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 17.3 6.2 20l1.1-6.3L2 9.4l6.4-.9L12 3l3.6 5.5 6.4.9-5.3 4.3L17.8 20z" /></svg>
            </button>

            <button id="copyLinkBtn" class="icon-btn" title="Copy Console link">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15 15 0 0 0 0 20"/></svg>
            </button>

            <button id="printBtn" class="icon-btn" title="Print / Save as PDF">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M6 9V2h12v7"/><rect x="6" y="13" width="12" height="8" rx="2"/></svg>
            </button>
          </div>
        </div>

        <hr style="margin:10px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">

        <div id="infoArea">
          <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px">
            <div><div class="small">Orbital</div><div id="orbital" class="small">—</div></div>
            <div><div class="small">Gravity</div><div id="gravity" class="small">—</div></div>
            <div><div class="small">Temperature</div><div id="temperature" class="small">—</div></div>
            <div><div class="small">Pressure</div><div id="pressure" class="small">—</div></div>
            <div><div class="small">Wind</div><div id="wind" class="small">—</div></div>
            <div><div class="small">Clouds</div><div id="clouds" class="small">—</div></div>
          </div>

          <div style="margin-top:10px">
            <div class="small">Phenomena</div>
            <div id="phenomena" class="small" style="margin-top:6px">—</div>
          </div>

          <div style="margin-top:10px">
            <div class="small">Composition</div>
            <pre id="composition" class="json" style="margin-top:6px">—</pre>
          </div>
        </div>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="small">Preview (inline)</div>
          <div class="row no-print">
            <button id="regenPreview" class="btn" title="Generate a preview variant">Variant</button>
            <button id="copySeed" class="btn">Copy Seed</button>
          </div>
        </div>

        <div id="miniPreview" class="preview">
          <div id="miniTitle" style="font-weight:700;margin-bottom:6px">—</div>
          <div id="miniSummary" class="small">—</div>

          <div class="mini-stat" style="margin-top:10px">
            <div style="width:28px">Temp</div>
            <div style="flex:1">
              <div style="display:flex;justify-content:space-between;font-size:12px">
                <span id="miniTemp">— °C</span><span id="miniPress">— bar</span>
              </div>
              <div style="height:8px;border-radius:6px;background:#021824;margin-top:6px;overflow:hidden">
                <div id="miniTempBar" class="temp-bar" style="width:40%"></div>
              </div>
            </div>
          </div>

          <div class="mini-stat">
            <div style="width:28px">Wind</div>
            <div style="flex:1" id="miniWind">— km/h • Clouds: —%</div>
          </div>

          <div style="margin-top:10px">
            <div class="small">Top phenomena</div>
            <div id="miniPhen" class="small">—</div>
          </div>
        </div>

        <div style="margin-top:10px">
          <div class="small">Raw JSON</div>
          <pre id="rawJson" class="json">—</pre>
        </div>
      </div>
    </div>
  </div>

<script type="module">
// Embedded deterministic generator + UI. The page uses the embedded generator by default (no external dependency).
(function(){
  // --- Embedded generator (same fallback used previously) ---
  function xmur3(str) {
    for (var i = 0, h = 1779033703 ^ str.length; i < str.length; i++)
      h = Math.imul(h ^ str.charCodeAt(i), 3432918353);
    h = (h << 13) | (h >>> 19);
    return function() {
      h = Math.imul(h ^ (h >>> 16), 2246822507);
      h = Math.imul(h ^ (h >>> 13), 3266489909);
      return (h ^= h >>> 16) >>> 0;
    };
  }
  function mulberry32(a) {
    return function() {
      var t = (a += 0x6D2B79F5) >>> 0;
      t = Math.imul(t ^ (t >>> 15), t | 1);
      t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
      return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
    };
  }
  function makeRng(seedInput) {
    const seedText = seedInput === undefined || seedInput === null
      ? String(Date.now() + Math.floor(Math.random()*1e9))
      : String(seedInput);
    const seedFn = xmur3(seedText);
    const seed = seedFn();
    const rand = mulberry32(seed);
    return {
      seedText,
      seed,
      random: () => rand(),
      rand: (min, max) => (rand() * (max - min) + min),
      randint: (min, max) => Math.floor((rand() * (max - min + 1)) + min),
      choice: (arr) => arr[Math.floor(rand() * arr.length)]
    };
  }

  const starClasses = ['O','B','A','F','G','K','M'];
  const luminosity = ['I','II','III','IV','V'];
  const phenomenaPool = [
    "Global dust storms", "Auroral curtains", "Methane rain", "Silicate particulates in atmosphere",
    "Supersonic jet streams", "Persistent lightning storms", "High-altitude hydrocarbons haze",
    "Cryovolcanic plumes", "Magnetospheric radiation belts", "Dense smog and photochemical haze",
    "Seasonal polar caps", "Thick sulfuric clouds", "Transient water vapor plumes"
  ];

  function buildComposition(rng, pType, tempC){
    const comps = [];
    if(pType.includes('Gas')){
      comps.push({gas:'H2',pct: +(rng.rand(60,92)).toFixed(1)});
      comps.push({gas:'He',pct: +(rng.rand(6,30)).toFixed(1)});
      if(rng.random() < 0.4) comps.push({gas:'CH4',pct: +(rng.rand(0.1,4)).toFixed(2)});
    } else {
      let n2 = +(rng.rand(30,90)).toFixed(1);
      let o2 = +(rng.rand(0,30)).toFixed(1);
      let co2 = +(rng.rand(0,10)).toFixed(2);
      if(Math.abs(tempC - 15) < 40 && rng.random() < 0.5){
        n2 = +(rng.rand(60,80)).toFixed(1);
        o2 = +(rng.rand(10,25)).toFixed(1);
        co2 = +(rng.rand(0.01,0.8)).toFixed(2);
      }
      comps.push({gas:'N2',pct:n2});
      if(o2>0.05) comps.push({gas:'O2',pct:o2});
      if(co2>0.01) comps.push({gas:'CO2',pct:co2});
      if(rng.random() < 0.4) comps.push({gas:'Ar',pct: +(rng.rand(0.1,1.2)).toFixed(2)});
      if(rng.random() < 0.35) comps.push({gas:'CH4',pct: +(rng.rand(0,2)).toFixed(2)});
      if(rng.random() < 0.35) comps.push({gas:'H2O',pct: +(rng.rand(0,6)).toFixed(2)});
      if(rng.random() < 0.12) comps.push({gas:'SO2',pct: +(rng.rand(0,4)).toFixed(2)});
    }
    let sum = comps.reduce((s,c)=>s+Number(c.pct),0);
    comps.forEach(c => { c.pct = +(100 * c.pct / sum).toFixed(2); });
    return comps.sort((a,b)=>b.pct - a.pct);
  }

  function generatePhenomena(rng, type, tempC, pressure, composition){
    const pool = [];
    if(type.includes('Gas')){
      pool.push("High-altitude banded storms");
      pool.push("Strong magnetospheric radio emissions");
    } else {
      if(composition.some(g=>g.gas==='CH4' && g.pct>1)) pool.push("Hydrocarbon haze and orange skies");
      if(composition.some(g=>g.gas==='SO2')) pool.push("Acidic cloud layers and sulfuric aerosols");
      if(Math.abs(tempC) < 100 && rng.random() < 0.5) pool.push("Seasonal storms and weather fronts");
      if(pressure > 50) pool.push("Supercritical atmospheric phenomena");
      if(rng.random() < 0.2) pool.push(rng.choice(phenomenaPool));
    }
    if(pool.length === 0) pool.push(rng.choice(phenomenaPool));
    return pool;
  }

  function evaluateHabitability({tempC, pressure, comp, gravity, pType}){
    let score = 0;
    if(pType==='Terrestrial' || pType==='Super-Earth' || pType==='Ocean World') score += 1;
    if(tempC >= -20 && tempC <= 50) score += 2;
    if(pressure >= 0.4 && pressure <= 5) score += 2;
    const o2 = (comp.find(c=>c.gas==='O2')||{pct:0}).pct;
    if(o2 >= 18 && o2 <= 25) score += 2;
    const toxic = (comp.find(c=>c.gas==='SO2')||{pct:0}).pct + (comp.find(c=>c.gas==='CH4')||{pct:0}).pct*0.2;
    if(toxic < 5) score += 1;
    if(gravity >= 0.5 && gravity <= 2.5) score += 1;
    const reasons = [];
    if(score >= 7) reasons.push("Conditions compatible with surface life and human habitability (within rough heuristic).");
    else {
      if(!(pType==='Terrestrial' || pType==='Super-Earth' || pType==='Ocean World')) reasons.push("Planet type unlikely for terrestrial habitability.");
      if(!(tempC >= -20 && tempC <= 50)) reasons.push(`Temperature (${tempC}°C) outside comfortable range.`);
      if(!(pressure >= 0.4 && pressure <= 5)) reasons.push(`Pressure (${pressure} bar) outside habitable window.`);
      if(!(o2 >= 18 && o2 <= 25)) reasons.push("Oxygen concentration not suitable for Earth-like respiration.");
      if(toxic >= 5) reasons.push("Toxic trace gases may be hazardous.");
      if(!(gravity >= 0.5 && gravity <= 2.5)) reasons.push("Gravity outside comfortable human tolerance.");
    }
    return { score, habitable: score >= 7, reasons };
  }

  function makeSystemName(rng){
    if(rng.random() < 0.25){
      return rng.choice(['Kepler','TRAPPIST','Gliese','HD','KIC']) + '-' + rng.randint(10,9999);
    }
    const a = String.fromCharCode(65 + rng.randint(0,25));
    const b = String.fromCharCode(65 + rng.randint(0,25));
    const digits = rng.randint(10,999);
    return `${a}${b}-${digits}`;
  }

  function makeStar(rng){
    const cls = rng.choice(starClasses);
    const sub = rng.randint(0,9);
    const lum = rng.choice(luminosity);
    const name = `${cls}${sub}${lum}`;
    const type = (() => {
      if (cls==='O' || cls==='B') return 'Massive luminous';
      if (cls==='A' || cls==='F') return 'Hot luminous';
      if (cls==='G') return 'Yellow dwarf (G-type)';
      if (cls==='K') return 'Orange dwarf (K-type)';
      return 'Red dwarf (M-type)';
    })();
    const luminosityFactor = ({O:50000,B:1000,A:20,F:6,G:1,K:0.4,M:0.04})[cls] || 1;
    return {name, type, cls, sub, lum, luminosityFactor};
  }

  function makePlanet(rng, systemName, star){
    const index = rng.randint(1,12);
    const base = Math.pow(1.5, index-1) * 0.35;
    const orbital = +(base * (0.7 + rng.random()*0.6)).toFixed(2);
    const sizeCategory = rng.random();
    let radiusEarth, massEarth, pType;
    if(sizeCategory < 0.25){
      pType = 'Terrestrial'; radiusEarth = +(rng.rand(0.3,1.2).toFixed(2)); massEarth = +(Math.pow(radiusEarth,3) * (0.7 + rng.random()*1.3)).toFixed(2);
    } else if(sizeCategory < 0.45){
      pType = 'Super-Earth'; radiusEarth = +(rng.rand(1.3,2.4).toFixed(2)); massEarth = +(rng.rand(2,10).toFixed(2));
    } else if(sizeCategory < 0.7){
      pType = 'Sub-Neptune'; radiusEarth = +(rng.rand(2.5,4.0).toFixed(2)); massEarth = +(rng.rand(10,40).toFixed(2));
    } else {
      pType = 'Gas Giant'; radiusEarth = +(rng.rand(4.0,11.0).toFixed(2)); massEarth = +(rng.rand(50,600).toFixed(0));
    }
    const gravity = +(massEarth / (radiusEarth*radiusEarth)).toFixed(2);
    let tempK = 278 * Math.pow(star.luminosityFactor, 0.25) / Math.sqrt(Math.max(orbital,0.2));
    tempK = tempK * (0.6 + rng.random()*1.8);
    const tempC = +(tempK - 273.15).toFixed(1);
    let pressure = +(Math.pow(rng.random(), 2) * 150).toFixed(2);
    if(pType === 'Terrestrial' && rng.random() < 0.6) pressure = +(pressure * 0.02 + 0.6).toFixed(2);
    if(pType.includes('Gas')) pressure = +(rng.rand(50,300).toFixed(2));
    const comp = buildComposition(rng, pType, tempC);
    const clouds = +(Math.min(100, Math.max(0, (comp.some(g=>g.gas==='H2O')? rng.randint(10,90) : rng.randint(0,95)) ))).toFixed(0);
    const wind = (pType.includes('Gas') ? rng.randint(100,1200) : rng.randint(0,250));
    const phenomena = generatePhenomena(rng, pType, tempC, pressure, comp);
    const habitability = evaluateHabitability({tempC, pressure, comp, gravity, pType});
    const planetLetter = String.fromCharCode(98 + Math.min(25, index));
    const planetCode = `${systemName.split('-')[0]}-${String(index).padStart(2,'0')}${planetLetter}`;
    return {
      systemName,
      planetCode,
      index,
      orbitalAU: orbital,
      radiusEarth,
      massEarth,
      gravity,
      tempC,
      pressureBar: +pressure,
      composition: comp,
      cloudsPercent: clouds,
      windKph: wind,
      type: pType,
      phenomena,
      habitability
    };
  }

  function setEarth(){
    const systemName = 'Sol';
    const star = {name:'Sun (G2V)', type:'G2V', luminosityFactor:1, cls:'G', sub:2, lum:'V'};
    const planet = {
      systemName,
      planetCode: 'Sol-01b',
      index: 3,
      orbitalAU: 1.00,
      radiusEarth: 1.0,
      massEarth: 1.0,
      gravity: 1.0,
      tempC: 15.0,
      pressureBar: 1.013,
      composition: [
        {gas:'N2',pct:78.08},
        {gas:'O2',pct:20.95},
        {gas:'Ar',pct:0.93},
        {gas:'CO2',pct:0.04},
        {gas:'CH4',pct:0.00018}
      ],
      cloudsPercent: 60,
      windKph: 110,
      type: 'Terrestrial',
      phenomena: ['Stable climate; seasonal variations; aurora in polar regions'],
      habitability: {score:10, habitable:true, reasons:['Local conditions are stable and livable (reference Earth).']}
    };
    return { star, planet, meta: { seedText: 'earth' } };
  }

  function generateDataset(opts = {}){
    if(opts.seed === 'earth' || opts.earth === true) return setEarth();
    const rng = makeRng(opts.seed);
    const systemName = makeSystemName(rng);
    const star = makeStar(rng);
    const planet = makePlanet(rng, systemName, star);
    return { star, planet, meta: { seedText: rng.seedText, seed: rng.seed } };
  }

  // --- UI wiring ---
  const PRESETS = ['Kepler-452','TRAPPIST-1','Gliese-667','HD-219134','A1B-207','ZQ-3','OB-X-12'];
  const destList = document.getElementById('destList');
  const favList = document.getElementById('favList');
  const favCount = document.getElementById('favCount');
  const custom = document.getElementById('customName');
  const selectedName = document.getElementById('selectedName');
  const selectedSummary = document.getElementById('selectedSummary');
  const goBtn = document.getElementById('goBtn');
  const orb = document.getElementById('orbital');
  const grav = document.getElementById('gravity');
  const tempEl = document.getElementById('temperature');
  const pres = document.getElementById('pressure');
  const wind = document.getElementById('wind');
  const clouds = document.getElementById('clouds');
  const phenomena = document.getElementById('phenomena');
  const composition = document.getElementById('composition');
  const rawJson = document.getElementById('rawJson');
  const regenPreview = document.getElementById('regenPreview');
  const miniTitle = document.getElementById('miniTitle');
  const miniSummary = document.getElementById('miniSummary');
  const miniTemp = document.getElementById('miniTemp');
  const miniPress = document.getElementById('miniPress');
  const miniWind = document.getElementById('miniWind');
  const miniPhen = document.getElementById('miniPhen');
  const miniTempBar = document.getElementById('miniTempBar');
  const copySeedBtn = document.getElementById('copySeed');
  const favToggle = document.getElementById('favToggle');
  const favIcon = document.getElementById('favIcon');
  const copyLinkBtn = document.getElementById('copyLinkBtn');
  const printBtn = document.getElementById('printBtn');
  const clearFavs = document.getElementById('clearFavs');

  let currentSeed = null; let currentDataset = null;
  const STORAGE_KEYS = { FAVS: 'nav_favorites_v1', LAST: 'nav_lastseed_v1' };

  function getFavorites(){ try{ const raw = localStorage.getItem(STORAGE_KEYS.FAVS); return raw ? JSON.parse(raw) : []; }catch(e){ return []; } }
  function setFavorites(arr){ localStorage.setItem(STORAGE_KEYS.FAVS, JSON.stringify(arr)); }
  function addFavorite(seed){ const favs = getFavorites(); if(!favs.includes(seed)){ favs.unshift(seed); setFavorites(favs.slice(0,30)); renderFavorites(); } }
  function removeFavorite(seed){ let favs = getFavorites(); favs = favs.filter(s=>s!==seed); setFavorites(favs); renderFavorites(); }

  function renderFavorites(){
    favList.innerHTML = '';
    const favs = getFavorites();
    favCount.textContent = favs.length;
    if(favs.length === 0){
      favList.innerHTML = '<div class="muted">No favorites yet — star a destination to save it here.</div>';;
      return;
    }
    favs.forEach(s=>{
      const btn = document.createElement('button');
      btn.className = 'preset-btn';
      btn.innerHTML = `<div class=\"preset-left\"><span class=\"seed-tag\">${s}</span></div>
                       <div style=\"display:flex;gap:6px;align-items:center\">\n                         <button title=\"Select\" class=\"icon-btn\" data-seed=\"${s}\">▶</button>\n                         <button title=\"Remove favorite\" class=\"icon-btn\" data-remove=\"${s}\">✕</button>\n                       </div>`;
      favList.appendChild(btn);
      btn.querySelector('[data-seed]')?.addEventListener('click', ()=> selectDestination(s));
      btn.querySelector('[data-remove]')?.addEventListener('click', (e)=> { removeFavorite(s); e.stopPropagation(); });
    });
  }

  function makeList(){
    destList.innerHTML = '';
    PRESETS.forEach(p=>{
      const wrapper = document.createElement('div');
      wrapper.className = 'preset-btn';
      wrapper.innerHTML = `<div class=\"preset-left\"><span class=\"seed-tag\">${p}</span><div class=\"small muted\" style=\"margin-left:8px\">preset</div></div>
                           <div style=\"display:flex;gap:6px;align-items:center\">\n                             <button title=\"Select\" class=\"icon-btn select\" data-seed=\"${p}\">▶</button>\n                             <button title=\"Favorite\" class=\"icon-btn star\" data-fav=\"${p}\">☆</button>\n                           </div>`;
      destList.appendChild(wrapper);
      wrapper.querySelector('.select')?.addEventListener('click', ()=> selectDestination(p));
      wrapper.querySelector('.star')?.addEventListener('click', (e)=> { toggleFavorite(p); e.stopPropagation(); });
    });
  }

  function toggleFavorite(seed){ const favs = getFavorites(); if(favs.includes(seed)) removeFavorite(seed); else addFavorite(seed); updateFavIcon(seed); }
  function updateFavIcon(seed){ const favs = getFavorites(); const starred = favs.includes(seed); favIcon.style.color = starred ? '#ffd66b' : 'currentColor'; }

  function selectDestination(name){
    currentSeed = name;
    currentDataset = generateDataset({ seed: name });
    updateDisplay(name, currentDataset);
    persistLastSeed(name);
    rawJson.textContent = JSON.stringify(currentDataset, null, 2);
    updateFavIcon(name);
    updateMiniPreviewVariant(false); // stable preview based on seed
  }

  function updateDisplay(name, ds){
    selectedName.textContent = name;
    selectedSummary.textContent = `${ds.planet.type} • ${ds.planet.radiusEarth} R⊕ • ${ds.planet.massEarth} M⊕`;
    orb.textContent = `${ds.planet.orbitalAU} AU`;
    grav.textContent = `${ds.planet.gravity} g`;
    tempEl.textContent = `${ds.planet.tempC} °C`;
    pres.textContent = `${ds.planet.pressureBar} bar`;
    wind.textContent = `${ds.planet.windKph} km/h`;
    clouds.textContent = `${ds.planet.cloudsPercent} %`;
    phenomena.textContent = ds.planet.phenomena.join('; ');
    composition.textContent = ds.planet.composition.map(c=>`${c.gas}: ${c.pct}%`).join('\n');
  }

  // show a compact preview — if variant=true, generate with timestamp so visuals vary
  function updateMiniPreviewVariant(variant){
    if(!currentDataset) return;
    const seedForPreview = variant ? `${currentSeed}::preview:${Date.now()}` : currentSeed;
    const pv = generateDataset({ seed: seedForPreview });
    miniTitle.textContent = pv.planet.planetCode;
    miniSummary.textContent = `${pv.planet.type} • ${pv.planet.radiusEarth} R⊕`;
    miniTemp.textContent = `${pv.planet.tempC} °C`;
    miniPress.textContent = `${pv.planet.pressureBar} bar`;
    miniWind.textContent = `${pv.planet.windKph} km/h • Clouds: ${pv.planet.cloudsPercent}%`;
    miniPhen.textContent = pv.planet.phenomena.slice(0,2).join('; ');
    // temperature bar: map temp roughly from -200 -> +200 to 0-100%
    const pct = Math.max(0, Math.min(100, ((pv.planet.tempC + 200) / 400) * 100));
    miniTempBar.style.width = pct + '%';
  }

  goBtn.addEventListener('click', ()=>{
    const name = (custom.value || '').trim();
    if(!name) return alert('Enter a name or pick a preset');
    selectDestination(name);
  });

  regenPreview.addEventListener('click', ()=> {
    if(!currentSeed) return alert('Pick a destination first');
    updateMiniPreviewVariant(true);
  });

  copySeedBtn?.addEventListener('click', ()=>{
    if(!currentSeed) return alert('Pick a destination first');
    navigator.clipboard?.writeText(currentSeed).then(()=> alert('Seed copied')).catch(()=> alert('Unable to copy'));
  });

  favToggle.addEventListener('click', ()=> { if(!currentSeed) return alert('Pick a destination first'); toggleFavorite(currentSeed); });

  copyLinkBtn.addEventListener('click', ()=>{
    if(!currentSeed) return alert('Pick a destination first');
    const url = `${location.origin}${location.pathname}?seed=${encodeURIComponent(currentSeed)}`;
    navigator.clipboard?.writeText(url).then(()=> alert('Console link copied')).catch(()=> alert('Unable to copy'));
  });

  printBtn.addEventListener('click', ()=>{
    if(!currentDataset) return alert('Pick a destination first');
    openPrintWindow(currentDataset);
  });

  clearFavs.addEventListener('click', ()=>{
    if(!confirm('Clear all favorites?')) return;
    setFavorites([]);
    renderFavorites();
  });

  function persistLastSeed(seed){ try{ localStorage.setItem(STORAGE_KEYS.LAST, seed); }catch(e){} }
  function loadLastSeed(){ try{ return localStorage.getItem(STORAGE_KEYS.LAST); }catch(e){return null;} }

  function openPrintWindow(ds){
    const w = window.open('', '_blank', 'noopener,width=800,height=900');
    if(!w) return alert('Unable to open print window (blocked).');
    const html = `<!doctype html>
  <html>
  <head>
    <meta charset="utf-8">
    <title>Print — ${escapeHtml(ds.planet.planetCode)}</title>
    <style>body{font-family:Helvetica,Arial,sans-serif;margin:20px;color:#111}h1{margin:0 0 10px}.meta{color:#444;margin-bottom:14px}.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}.box{border:1px solid #ddd;padding:10px;border-radius:6px}pre{white-space:pre-wrap;word-wrap:break-word;background:#f6f8fa;padding:8px;border-radius:4px}@media print{ .no-print{display:none} }</style>
  </head>
  <body>
    <h1>${escapeHtml(ds.planet.planetCode)}</h1>
    <div class="meta">${escapeHtml(ds.planet.type)} • ${escapeHtml(String(ds.planet.radiusEarth))} R⊕ • ${escapeHtml(String(ds.planet.massEarth))} M⊕</div>
    <div class="grid">
      <div class="box"><strong>Orbital</strong><div>${escapeHtml(String(ds.planet.orbitalAU))} AU</div></div>
      <div class="box"><strong>Gravity</strong><div>${escapeHtml(String(ds.planet.gravity))} g</div></div>
      <div class="box"><strong>Temperature</strong><div>${escapeHtml(String(ds.planet.tempC))} °C</div></div>
      <div class="box"><strong>Pressure</strong><div>${escapeHtml(String(ds.planet.pressureBar))} bar</div></div>
      <div class="box"><strong>Wind</strong><div>${escapeHtml(String(ds.planet.windKph))} km/h</div></div>
      <div class="box"><strong>Clouds</strong><div>${escapeHtml(String(ds.planet.cloudsPercent))} %</div></div>
    </div>

    <h3 style="margin-top:16px">Phenomena</h3>
    <div class="box"><div>${escapeHtml(ds.planet.phenomena.join('; '))}</div></div>

    <h3 style="margin-top:12px">Atmospheric Composition</h3>
    <div class="box"><pre>${escapeHtml(ds.planet.composition.map(c=>`${c.gas}: ${c.pct}%`).join('\n'))}</pre></div>

    <div style="margin-top:18px" class="no-print">
      <button onclick="window.print()">Print / Save as PDF</button>
      <button onclick="window.close()">Close</button>
    </div>
  </body>
  </html>`;
    w.document.open(); w.document.write(html); w.document.close();
    setTimeout(()=>{ try{ w.print(); }catch(e){} }, 300);
  }

  function escapeHtml(str){ return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  function getUrlSeed(){ try{ const params = new URLSearchParams(location.search); return params.get('seed'); }catch(e){return null;} }

  // init
  renderFavorites(); makeList();
  const urlSeed = getUrlSeed(); const lastSeed = loadLastSeed(); const initial = urlSeed || lastSeed || PRESETS[0];
  selectDestination(initial);
})();
</script>
</body>
</html>